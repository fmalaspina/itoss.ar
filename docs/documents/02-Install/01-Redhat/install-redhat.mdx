import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Basic ITOSS Installation on Redhat-based Linux

The basic installation, all essential functions are installed on the same server, is intended to be used for demonstrations, tests, or small environments of up to 100 managed components (orientative number for a standard operation).

This guide includes the installation of the following functions and/or software packages:

* Database - Postgresql 14 + Timescale
* Web Server - ngnix
* ITOSS Manager
* ITOSS Collector

## Hardware requirements
The minimum hardware requirements to run all the central functions of ITOSS on a virtual server are:

* 8 CPU
* 16 RAM
* 50 GB of disk space.

## Operating system
This guide is oriented and tested on Linux based on Redhat, a dedicated server for ITOSS is recommended and on a clean installation.

***

## Previous steps

### Installing Postgres + TimeScaleDB
1. Configure IT repositories

<Tabs groupId="operating-systems">
  <TabItem value="redhat" label="Red Hat">

```shell
yum install https://download.postgresql.org/pub/repos/yum/reporpms/EL-$(rpm -E %{rhel})-x86_64/pgdg-redhat-repo-latest.noarch.rpm
```
  
  </TabItem>

  <TabItem value="fedora" label="Fedora">

```shell
yum install https://download.postgresql.org/pub/repos/yum/reporpms/F-$(rpm -E %{fedora})-x86_64/pgdg-fedora-repo-latest.noarch.rpm
```
  </TabItem>

  <TabItem value="centos" label="CentOS">

```shell
yum install https://download.postgresql.org/pub/repos/yum/reporpms/EL-$(rpm -E %{centos})-x86_64/pgdg-redhat-repo-latest.noarch.rpm
```
  </TabItem>

</Tabs>

2. Create the TimeScale repository

<Tabs groupId="operating-systems">

  <TabItem value="redhat" label="Red Hat">

```shell
tee /etc/yum.repos.d/timescale_timescaledb.repo <<EOL
[timescale_timescaledb]
name=timescale_timescaledb
baseurl=https://packagecloud.io/timescale/timescaledb/el/$(rpm -E %{rhel})/\$basearch
repo_gpgcheck=1
gpgcheck=0
enabled=1
gpgkey=https://packagecloud.io/timescale/timescaledb/gpgkey
sslverify=1
sslcacert=/etc/pki/tls/certs/ca-bundle.crt
metadata_expire=300
EOL
```
</TabItem>
<TabItem value="fedora" label="Fedora">

```shell
tee /etc/yum.repos.d/timescale_timescaledb.repo <<EOL
[timescale_timescaledb]
name=timescale_timescaledb
baseurl=https://packagecloud.io/timescale/timescaledb/el/8/$basearch
repo_gpgcheck=1
gpgcheck=0
enabled=1
gpgkey=https://packagecloud.io/timescale/timescaledb/gpgkey
sslverify=1
sslcacert=/etc/pki/tls/certs/ca-bundle.crt
metadata_expire=300
EOL
```    

</TabItem>
<TabItem value="centos" label="CentOS">

```shell
tee /etc/yum.repos.d/timescale_timescaledb.repo <<EOL
[timescale_timescaledb]
name=timescale_timescaledb
baseurl=https://packagecloud.io/timescale/timescaledb/el/$(rpm -E %{rhel})/\$basearch
repo_gpgcheck=1
gpgcheck=0
enabled=1
gpgkey=https://packagecloud.io/timescale/timescaledb/gpgkey
sslverify=1
sslcacert=/etc/pki/tls/certs/ca-bundle.crt
metadata_expire=300
EOL
```  
  
  </TabItem>
</Tabs>


3. Update repositories

```shell
yum update 
```


4. Install postgres + timeScaleDB

```shell
yum install timescaledb-2-postgresql-14

```

### WEB Server Installation (NGINX)

_More information: https://nginx.org/en/linux_packages.html##RHEL-CentOS_

1. Install required packages

```shell
sudo yum install yum-utils
```
2. Create a file named /etc/yum.repos.d/nginx.repo with the following content:

```shell
[nginx-stable]
name=nginx stable repo
baseurl=http://nginx.org/packages/centos/$releasever/$basearch/
gpgcheck=1
enabled=1
gpgkey=https://nginx.org/keys/nginx_signing.key
module_hotfixes=true

[nginx-mainline]
name=nginx mainline repo
baseurl=http://nginx.org/packages/mainline/centos/$releasever/$basearch/
gpgcheck=1
enabled=0
gpgkey=https://nginx.org/keys/nginx_signing.key
module_hotfixes=true
```

3. By default, the stable version is used. If you want the latest version run:
```shell
sudo yum-config-manager --enable nginx-mainline
```

4. Install nginx

```shell
sudo yum install nginx
```

5. Check key (optional)
When asked to accept the GPG key, verify that it matches: 573B FD6B 3D8F BC64 1079 A6AB ABF5 BD82 7BD9 BF62, if it does, accept it.
***
ITOSS Installation and Configuration
Install ITOSS
Follow these steps:

1. Download the software to the "/" directory.

    **[Go to resources](/resources)**

2. Unzip the archive in directory "/"

    ```shell
    cd /
    tar xvf itoss-v5.2.tar.gz
    ```

3. Create the database and load initial data.

    ```shell
    sudo su â€“ postgres 
    $ psql 
    CREATE USER itoss WITH PASSWORD 'admin'; 
    CREATE DATABASE itossdb; 
    \c itossdb; 
    ALTER DATABASE itossdb OWNER TO itoss; 
    ALTER SCHEMA public OWNER TO itoss; 
    \q
    psql -U itoss -d itossdb
    CREATE EXTENSION IF NOT EXISTS timescaledb;

    SELECT timescaledb_pre_restore(); 
    \q
    psql -d itossdb -f /app/setup/itossdb-initial.sql
    psql
    \c itossdb
    SELECT timescaledb_post_restore(); 
    ```

4. Create ITOSS services and run the application

    ```shell
    cp /app/setup/*.service /etc/systemd/system/ 
    sudo systemctl enable itoss-manager.service 
    sudo systemctl enable itoss-collector.service 
    sudo systemctl enable itoss-reporting.service 
    sudo systemctl start itoss-manager 
    sudo systemctl start itoss-collector.service 
    sudo systemctl start itoss-reporting.service 
    ```

***

### Powershell installation (optional)

In cases where you need to manage components through Powershell (for example from the Microsoft ecosystem).

_For more information:
[https://docs.microsoft.com/en-us/powershell/scripting/install/install-ubuntu?view=powershell-7.2](https://docs.microsoft.com/en-us/powershell/scripting/install/install-ubuntu?view=powershell-7.2)_

```shell
sudo apt-get install -y wget apt-transport-https software-properties-common
wget -q[ <https://packages.microsoft.com/config/ubuntu/>$(lsb_release -rs)/packages-microsoft-prod.deb](https://packages.microsoft.com/config/ubuntu/$(lsb_release%20-rs)/packages-microsoft-prod.deb)
sudo dpkg -i packages-microsoft-prod.deb
sudo apt-get update
sudo apt-get install -y powershell
sudo apt-get install -y gss-ntlmssp
```
